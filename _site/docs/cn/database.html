<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
<link href="/stylesheets/foundation.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/stylesheets/pygment_trac.css" media="screen" />
<link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen" />
<link rel="stylesheet" type="text/css" href="/stylesheets/prism.css"/>
<script src="/javascripts/foundation.min.js"></script>
<script type="text/javascript">
	$(document).ready(function() {
		$(document).foundationTopBar() 
	})
</script>

<!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
	<title>数据库</title>
</head>
<body>
	<nav class="top-bar fixed">
		<ul>
			<!-- Title Area -->
			<li class="name">
				<h1>
					<a href="/">
						<img src="/images/blade-bar-logo.png" alt="logo" width="25" height="25" />
						&nbsp; Blade Web Framework
					</a>
				</h1>
			</li>
			<li class="toggle-topbar"><a href="#"></a></li>
		</ul>
		<section>
			<!-- Right Nav Section -->
			<ul class="right" style="padding-right: 10px;">
				<li>
					<a href="/index.html" class="fa fa-home"> 首页</a>
				</li>
				<li>
					<a href="/apidocs" class="fa fa-book"> API文档</a>
				</li>
				<!-- <li class="divider"></li> -->
				<li class="has-dropdown">
					<a class="fa fa-hashtag" href="/docs/cn/overview.html"> 开发指南</a>
					<ul class="dropdown">
						

	
	
	<li class="">
		<a href="/docs/cn/overview.html"><i class="fa fa-home"></i> 框架简介</a>
	</li>

	
	
	<li class="">
		<a href="/docs/cn/architecture.html"><i class="fa fa-sitemap"></i> 系统架构</a>
	</li>

	
	
	<li class="">
		<a href="/docs/cn/quickstart.html"><i class="fa fa-paper-plane-o"></i> 快速入门</a>
	</li>

	
	
	<li class="">
		<a href="/docs/cn/core.html"><i class="fa fa-diamond"></i> 核心概念</a>
	</li>

	
	
	<li class="">
		<a href="/docs/cn/view.html"><i class="fa fa-code"></i> 视图模板</a>
	</li>

	
	
	<li class="">
		<a href="/docs/cn/configuration.html"><i class="fa fa-cog"></i> 框架配置</a>
	</li>

	
	
	<li class="active">
		<a href="/docs/cn/database.html"><i class="fa fa-cubes"></i> 数据库</a>
	</li>

					</ul>
				</li>

				<li>
					<a href="/license.html" class="fa fa-legal"> License</a>
				</li>

				<li>
					<a href="/index_en.html"  class="fa fa-language"> English</a>
				</li>

			</ul>
		</section>
	</nav>

	<!-- Main Body -->
	<div class="row">
		<div class="nine columns">
			<div id="content">
				<h1 id="数据库操作">数据库操作</h1>

<h2 id="特性">特性</h2>

<ul>
  <li>语法简洁，代码量少</li>
  <li>不依赖第三方框架(除了日志接口)</li>
  <li>DSL风格，让程序写起来像一条链</li>
  <li>内置连接池，支持其他连接池</li>
</ul>

<h2 id="使用方法">使用方法</h2>

<pre><code class="language-java">public class ActiveRecordTest {

    private static final Logger LOGGER = LoggerFactory.getLogger(ActiveRecordTest.class);

    private ActiveRecord activeRecord;

    protected DataSource testDefaultPool() {
        try {
            return DataSourceFactory.createDataSource("jdbc.properties");
        } catch (Exception ex) {
            ex.printStackTrace();
        }
        return null;
    }

    protected DataSource testHikariPool() {
        HikariConfig config = new HikariConfig();
        config.setMaximumPoolSize(100);
        config.setDataSourceClassName("com.mysql.jdbc.jdbc2.optional.MysqlDataSource");
        config.addDataSourceProperty("serverName", "localhost");
        config.addDataSourceProperty("databaseName", "demo");
        config.addDataSourceProperty("user", "root");
        config.addDataSourceProperty("password", "root");
        config.setInitializationFailFast(true);
        return new HikariDataSource(config);
    }

    protected DataSource testDruidPool() {
        try {
            InputStream in = ActiveRecordTest.class.getClassLoader().getResourceAsStream("druid.properties");
            Properties props = new Properties();
            props.load(in);
            return DruidDataSourceFactory.createDataSource(props);
        } catch (Exception ex) {
            ex.printStackTrace();
        }
        return null;
    }

    @Before
    public void before(){
        activeRecord = new SampleActiveRecord(testDefaultPool());
    }

    @Test
    public void testCount(){
        int count = activeRecord.count(new Person());
        LOGGER.info("记录数：{}", count);
    }

    @Test
    public void testList(){
        List&lt;Person&gt; personList = activeRecord.list(new Person());
        LOGGER.info(personList.toString());
    }

    @Test
    public void testTakeList(){
        Take criteria = new Take(Person.class);
        criteria.like("name", "Me%");
        List&lt;Person&gt; persons = activeRecord.list(criteria);
        LOGGER.info(persons.toString());
    }

    @Test
    public void testUpdate(){
        Person temp = new Person();
        temp.setId(1);
        temp.setLast_name("asd");
        activeRecord.update(temp);
    }

    @Test
    public void testPage(){
        Paginator&lt;Person&gt; page = activeRecord.page(new Person(), 2, 10);
        LOGGER.info(page.toString());
    }

    @Test
    public void testListPage(){
        String sql = "select * from person";
        List&lt;Person&gt; list = activeRecord.list(Person.class, sql, new PageRow(1, 10, "created_at desc"));
        LOGGER.info(list.toString());
    }

    @Test
    public void testIn1(){
        List&lt;Person&gt; list = activeRecord.list(new Take(Person.class).in("id", 1, 2, 3));
        LOGGER.info(list.toString());
    }

    @Test
    public void testIn2(){
        List&lt;Integer&gt; ids = new ArrayList&lt;&gt;();
        ids.add(1);
        ids.add(2);
        ids.add(3);
        List&lt;Person&gt; list = activeRecord.list(new Take(Person.class).in("id", ids));
        LOGGER.info(list.toString());
    }

    @Test
    public void testOr(){
        Take take = new Take(Person.class);
        take.eq("name", "Tarik");
        take.or("last_name", "=", "Tarik");
        int count = activeRecord.count(take);
        LOGGER.info(count+"");
    }

    @Test
    public void testTx(){
        Person p1 = new Person();
        p1.setLast_name("Hello44");
        p1.setId(1);
        Tx.begin();
        int c = 1/0;
        activeRecord.update(p1);
        Tx.commit();
    }

}
</code></pre>

			</div>
		</div>

		<!-- Sidebar -->
		<div class="three columns sidebar">
			<a href="https://github.com/biezhi/blade" class="radius button fa fa-github huge">
				Download <br/> from Github
			</a>
			<h4>开发指南</h4>
			<ul class="side-nav">
				

	
	
	<li class="">
		<a href="/docs/cn/overview.html"><i class="fa fa-home"></i> 框架简介</a>
	</li>

	
	
	<li class="">
		<a href="/docs/cn/architecture.html"><i class="fa fa-sitemap"></i> 系统架构</a>
	</li>

	
	
	<li class="">
		<a href="/docs/cn/quickstart.html"><i class="fa fa-paper-plane-o"></i> 快速入门</a>
	</li>

	
	
	<li class="">
		<a href="/docs/cn/core.html"><i class="fa fa-diamond"></i> 核心概念</a>
	</li>

	
	
	<li class="">
		<a href="/docs/cn/view.html"><i class="fa fa-code"></i> 视图模板</a>
	</li>

	
	
	<li class="">
		<a href="/docs/cn/configuration.html"><i class="fa fa-cog"></i> 框架配置</a>
	</li>

	
	
	<li class="active">
		<a href="/docs/cn/database.html"><i class="fa fa-cubes"></i> 数据库</a>
	</li>

			</ul>
		</div>
	</div>
	
	<!-- Footer -->
	<footer class="row">
		<div class="twelve columns">
			<div class="row">
				<div class="six columns">
					<p>&copy; Copyright 2017, <a href="http://bladejava.com" >Blade Framework</a></p>
				</div>
				<div class="six columns">
					<ul class="inline-list right">
						<!-- <li><a href="#">Link 1</a></li> -->
					</ul>
				</div>
			</div>
		</div>
	</footer>
</body>
</html>
